# 预处理器

## 工作原理
在对C/C++语言进行编译前根据预处理指令对程序进行修改，预处理指令是由`#`开头的命令，预处理指令可以令程序更加易读，经过预处理器的处理，程序的内容将被修改为编译器可以识别的代码。

## 预处理指令
- 宏定义：`#define`指令定义一个宏，`#undef`指令删除一个宏定义
- 文件包含：`#include`指令导致一个指定文件的内容被包含到程序中
- 条件编译：`#if`、`#ifdef`、`#ifndef`、`#elif`、`#else`和`#endif`指令可以根据预处理器可以测试的条件来确定一段文本是否需要包含到程序中

预处理器的特性：
- 以`#`开头
- 指令的符号间可以插入任意数量的空格或水平制表符
- 指令总在第一个换行符结束，如想在下一行继续，必须在末尾插入`\`
- 指令可以出现在程序中任意地方
- 注释可以与指令放在同一行

## 宏定义
### 简单的宏
`#define 标识符 替换列表`
通常使用宏定义来定义常量，不要对宏中插入任何多余的符号，否则他们会被作为替换列表的一部分。

### 带参数的宏
`#define 标识符(x1, x2, x3, ...) 替换列表`

标识符与括号间不允许有任何空格，否则括号将被识别为替换列表的内容。

`#define MAX(x, y) ((x) > (y) ? (x) : (y))`

将参数带上括号是有必要的，因为x与y很可能是表达式，而宏定义与函数调用不同，会产生意外的结果。

### #&##运算符
宏定义中可以包含两种特殊的运算符：
- #运算符：将参数完全看做字符串变量，
  ```
  #define PRINT_INT(n) printf(#n " = %d", n)
  PRINT_INT(i/j); <==> printf("i/j" " = %d", i/j);
  ```
- ##运算符：将两个记号粘合起来，成为新的记号
  ```
  #define MK_ID(n) i##n
  int MK_ID(1), MK_ID(2), MK_ID(3); <==> int i1, i2, i3;
  ```

### 通用属性
- 可以使用其他宏
- 只会替换完整的记号
- 定义作用范围为整个文件
- 不可以被重复定义
- 使用`#undef`取消定义

### 预定义宏

|    名称    | 描述                   |
| :--------: | :--------------------- |
| `__LINE__` | 被编译的文件的行号     |
| `__FILE__` | 被编译的文件名         |
| `__DATE__` | 编译日期(Mmm dd yyyy)  |
| `__TIME__` | 编译时间(hh:mm:ss)     |
| `__STDC__` | 编译器是否符合C89或C99 |

## 条件编译

```
#if 常量表达式
...
#elif 常量表达式
...
#else
...
#endif
```

根据条件将使得对应内容生效。通常判断某个标识符是否定义，故存在`#ifdef`和`#ifndef`方便使用。

## 其他预处理指令
- `#error 消息`：输出编译时错误
- `#line n [文件名]`：改变行编号方式
- `#pragma 记号`：特殊编译功能

[返回目录](../CONTENTS.md)