# 输入输出

## 输出函数
`printf`函数是用于显示“格式串”的内容，用法为：

`printf(格式串, 表达式1, 表达式2, ...)`

格式串由普通字符和转换说明（conversion specification）组成。

### 转换说明
转换说明的结构为：`%m.pX`或`%-m.pX`，其中：

- m为最小字段宽度，其指定了需要显示的最少字符的数量，若字符数小于该值，则会在字符左边填充空格。若在m前放置`-`号，则会在字符串右边填充空格。
- p为精度，对于不同的X，p的含义不同
  - d：代表十进制显示的个数，若不足，则在前面补充0
  - e：指数形式浮点数，p规定小数点后位数
  - f：小数点后位数

### 转义字符
由`\`后跟字符表示

## 输入函数
`scanf`函数根据特定的格式读取输入。

`scanf(格式串, &变量1, &变量2, ...)`

### 工作方式
![](img/io_1.jpg)
当程序执行到`scanf("%d", &a);`时，程序向CPU发出指令，要求其先检测输入缓冲内有没有数据，本程序内输入缓冲内没有数据，CPU开始等待输入设备（键盘）向输入缓冲内输入数据，这里输入一个“2”，输入后按enter，此时2和换行符一并被输入设备写入输入缓冲，输入缓冲检测到有回车进来了，CPU开始执行读取指令，将2读取后将其从输入缓冲清除，从输入缓冲将数据“2”赋值给a，由于a是一个具体的地址空间变量，所以赋值结束后，CPU将a的值写入输入缓冲，对于笔记本电脑而言，a的保存输出设备就是电脑硬盘，所以电脑硬盘就是输出设备。

对于不同数据类型处理方式：
- %d：对于整型数据的输入，也就是说”%d”类型的输入，scanf默认的分割符是所有的空白字符(空格，回车和指标符都行)。也就是说如果一个scanf函数中出现`scanf("%d%d", &a, &b) `，那么用任何一个空白字符来分隔两个整数a,b的值，变量a,b都可以接收到正确的输入。另外，要注意的是，scanf对于数字输入，会忽略输入数据项前面的空白字符。 
- %s：scanf对于字符串输入的处理和对整数类似，会忽略前导的空白字符，而且默认的分隔符是所有的空白字符。但是，要注意的是，由于C语言中，没有string类型，都是用char型数组来表示。因此，scanf会为每一个输入的字符串最后加一个‘\0’ （NULL）。
- %c：scanf在处理对字符数据的输入时，既不会忽略前导空白字符，默认也没有任何分隔字符。所有的字符，包括空白字符都会被当成输入字符。

## C语言缓冲区

### 缓冲区的三种类型 
#### 全缓冲 
在这种情况下，当填满标准I/O缓存后才进行实际I/O操作。全缓冲的典型代表是对磁盘文件的读写。 
#### 行缓冲
scanf()函数的缓冲类型就是这个，在这种情况下，当在输入和输出中遇到换行符时，执行真正的I/O操作。这时，我们输入的字符先存放在缓冲区，等按下回车键换行时才进行实际的I/O操作。典型代表是键盘输入数据。 
#### 不带缓冲 
也就是不进行缓冲，标准出错情况stderr是典型代表，这使得出错信息可以直接尽快地显示出来。

### C语言操作缓冲区

对于以下程序：
```
#include <stdio.h>
void main() {
    char a ,b ;  
    printf("请输入a和b的值：");  
    scanf("%c%c",&a,&b);
    printf("a=%c,b=%c\n",a,b);  
    printf("请输入a和b的值：");  
    scanf("%c%c",&a,&b);
    printf("a=%c,b=%c\n",a,b);  
}
```
输出如图：
![](img/io_2.png)

分析： 
- 1~5：行程序正常执行； 
- 6：程序走到这里，scanf检测到输入缓冲区没有字符，开始等待输入；我们输入了两个字符AB，这是我们一共在按键上依次按下”A”，”B”，“enter”，于是缓冲区现在有这三个字符；AB被分别分给了字符变量a，b；并且被清除了；于是缓冲区内就剩下了“enter”； 
- 7：程序正常输出a,b值； 
- 8：正常执行程序； 
- 9：程序走到这里，scanf检测缓冲区内有字符，但是只有一个字符“enter”，不够再次分配两个变量的，所以程序让再输入一个字符；可是我们输入了两个字符，AB；程序结束后，a被赋值“enter”，b被赋值A，这时缓冲区不仅将会剩下一个B字符，还会剩下一个“enter”；这个缓冲区的内容会随着程序的结束而被消除，由于不操作了，所以我们感觉不到他俩的存在； 
- 10：a，b再次被输出，a被输出了回车，所以换行了，a被输出了A； 
- 程序结束；

#### 缓冲区的刷新 
下面几种情况将引起缓冲区刷新，也就是清空所有数据： 
1. 缓冲区被写满
2. 执行flush语句
3. 执行endl语句
4. 关闭文件

__fflush(stdin)函数清除缓冲区__
```
#include <stdio.h>
void main() {
    char a ,b ;  
    printf("请输入a和b的值：");  
    scanf("%c%c",&a,&b);
    printf("a=%c,b=%c\n",a,b);  
    printf("请输入a和b的值："); 
    fflush(stdin);      //清除输入缓冲区； 
    scanf("%c%c",&a,&b);
    printf("a=%c,b=%c\n",a,b);  
}
```
结果如下：
![](img/io_3.png)